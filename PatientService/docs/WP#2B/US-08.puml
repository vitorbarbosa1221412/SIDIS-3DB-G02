@startuml
actor "Patient" as patient
participant "AppointmentController" as controller
participant "AppointmentService" as service
participant "PatientService" as patientService
participant "AppointmentRepository" as appointmentRepo
database "Database" as db

patient -> controller: GET /api/appointments/my-appointments
activate controller
note left: Requer autenticação\ne role PATIENT

controller -> patientService: getCurrentPatient()

patientService --> controller: loggedInPatient


controller -> service: getPatientAppointmentHistory(loggedInPatient)


service -> appointmentRepo: viewAppointmentByNumber(patient)


appointmentRepo -> db: SELECT a.*, p.*\nFROM appointments a\nJOIN physicians p ON a.physician_id = p.id\nWHERE a.patient_id = ?\nORDER BY a.date_time DESC



db --> appointmentRepo: List<Appointment>


appointmentRepo --> service: List<Appointment>




service --> controller: List<Appointment>


controller --> patient: HTTP 200 OK\n(Lista de Appointments)


@enduml