spring.application.name=patient-service

#
## server
## HTTPS CONFIGURATION
server.port=0
server.ssl.enabled=true
server.ssl.key-store=classpath:ssl/patient-keystore.p12
server.ssl.key-store-password=sidis123
server.ssl.key-store-type=PKCS12
server.ssl.key-alias=patient-tls-alias

##
## Profiles
##
spring.profiles.active=bootstrap

##
## OpenAPI
##
springdoc.api-docs.enabled=true
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui

##
## JWT (Mantidas as chaves para JwtDecoder)
##
jwt.private.key=classpath:rsa.private.key
jwt.public.key=classpath:rsa.public.key


spring.security.oauth2.resourceserver.jwt.issuer-uri=https://localhost:8443

## show SQL (mantido)
spring.jpa.show-sql=false
hibernate.show_sql=false
spring.jpa.hibernate.format_sql=true

## database schema generation (mantido)
spring.jpa.generate-ddl=true
spring.jpa.hibernate.ddl-auto=update

hibernate.ejb.naming_strategy=org.hibernate.cfg.ImprovedNamingStrategy

##
## H2 console for development purposes.
##
#spring.h2.console.enabled=true
#spring.h2.console.path=/h2-console

# PostgreSQL Database Configuration (can be overridden by environment variables)
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/sidis_patients_db}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:postgres}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:UoU4CrIoGNgOtK31}

##
## MULTIPART (MultipartProperties) (mantido)
##
spring.servlet.multipart.enabled=true
spring.servlet.multipart.file-size-threshold=2KB
spring.servlet.multipart.max-file-size=200MB
spring.servlet.multipart.max-request-size=215MB

##
## Peer-to-peer replication config
##
# Peer URLs for cross-instance data retrieval (comma-separated)
patient.peer.urls=${PATIENT_PEER_URLS:}

##
## External Services Configuration (TODOS EM HTTPS!)
##
physician.service.url=https://localhost:8444/api/physicians
appointment.service.url=https://localhost:8446/api/appointments

# Connection timeouts for external service calls (mantido)
external.services.connection-timeout=5000
external.services.read-timeout=10000

##
## RabbitMQ Configuration
##
spring.rabbitmq.host=${RABBITMQ_HOST:localhost}
spring.rabbitmq.port=${RABBITMQ_PORT:5672}
spring.rabbitmq.username=${RABBITMQ_USERNAME:guest}
spring.rabbitmq.password=${RABBITMQ_PASSWORD:guest}
spring.rabbitmq.virtual-host=/

# Message serialization
spring.rabbitmq.template.default-receive-queue=patient.events
spring.rabbitmq.listener.simple.acknowledge-mode=auto
spring.rabbitmq.listener.simple.retry.enabled=true
spring.rabbitmq.listener.simple.retry.max-attempts=3

##
## Actuator Configuration
##
#management.endpoints.web.exposure.include=health,info,metrics
#management.endpoint.health.show-details=when-authorized
management.health.rabbitmq.enabled=true

management.endpoints.web.exposure.include=*
management.endpoints.web.base-path=/internal

##
## Service Instance Configuration (for multi-instance deployment)
##
server.instance.id=${INSTANCE_ID:patient-service-1}

# Logging - Write to shared log directory for Alloy collection
logging.level.org.springframework=DEBUG
#logging.file.name=/SIDIS-25-26/logs/patient-service/app.log
logging.file.name=/var/log/sidis/patient-service/app.log
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# Tracing
management.tracing.enabled=true
#management.otlp.tracing.endpoint=http://localhost:4318/v1/traces
management.otlp.tracing.endpoint=http://tempo:4318/v1/traces
management.tracing.sampling.probability=1.0
management.otlp.metrics.export.enabled=false