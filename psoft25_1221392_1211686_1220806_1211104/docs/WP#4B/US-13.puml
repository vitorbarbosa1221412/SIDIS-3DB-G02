@startuml
title US-13: As a Physician, I want to update appointment records in case of errors or additional information

autonumber
autoactivate on

actor "Physician" as physician
participant "AppointmentRecordController" as api
participant "AppointmentRecordService" as service
participant "Mapper: AppointmentRecordMapper" as mapper
participant "repo: AppointmentRecordRepository" as repo
participant "obj: AppointmentRecord" as record

physician -> api : PUT /api/appointmentRecords/{recordNumber}\nBody: UpdateAppointmentRecordRequest
api -> service : updateAppointmentRecord(recordNumber, request)

service -> repo : findByRecordNumber(recordNumber)
repo --> service : Optional<AppointmentRecord>

service -> mapper : update(request, existingRecord)
mapper -> record : setDiagnosis(request.getDiagnosis())
mapper -> record : setTreatmentRecommendation(request.getTreatmentRecommendation())
mapper -> record : setPrescription(request.getPrescription())
mapper --> service : void

service -> repo : save(existingRecord)
repo --> service : updatedRecord
service --> api : updatedRecord
api --> physician : HTTP 200 OK + body(AppointmentRecord)

@enduml